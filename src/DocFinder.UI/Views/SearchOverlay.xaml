<ui:FluentWindow x:Class="DocFinder.UI.Views.SearchOverlay"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="DocFinder" Width="720" Height="420"
    WindowStartupLocation="CenterScreen"
    WindowStyle="None"
    WindowCornerPreference="Round"
    ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica"
    ResizeMode="CanResize"
    ShowInTaskbar="True">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <ui:TitleBar Grid.Row="0" Title="DocFinder" Foreground="{DynamicResource TextFillColorPrimaryBrush}" />

        <Grid Grid.Row="1" Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Search bar -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <ui:Button
                    x:Name="MenuButton"
                    Width="36"
                    Height="36"
                    Appearance="Secondary"
                    CornerRadius="8"
                    Click="MenuButton_Click">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="Navigation16" />
                    </ui:Button.Icon>
                    <ui:Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Nové hledání" Click="Menu_NewSearch_Click">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Search28" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="Nastavení…" Click="Menu_Settings_Click">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Settings28" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="Přeindexovat" Click="Menu_Reindex_Click">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="ArrowClockwise28" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem x:Name="PauseResumeMenuItem" Header="Pozastavit indexaci" Click="Menu_PauseResume_Click">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon x:Name="PauseResumeIcon" Symbol="PauseCircle24" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="Ukončit" Click="Menu_Exit_Click">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Dismiss28" />
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </ui:Button.ContextMenu>
                </ui:Button>

                <ui:TextBox
                    x:Name="QueryTextBox"
                    Grid.Column="1"
                    Text="{Binding Query, UpdateSourceTrigger=PropertyChanged}"
                    Height="40"
                    Padding="10"
                    Margin="8,0,8,0"
                    PlaceholderEnabled="True"
                    PlaceholderText="Hledat…" />

                <ui:Button
                    Grid.Column="2"
                    Width="36"
                    Height="36"
                    Appearance="Secondary"
                    Command="{Binding SearchCommand}">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="Search28" />
                    </ui:Button.Icon>
                </ui:Button>
            </Grid>

            <!-- Results and detail -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <ListBox Grid.Column="0" ItemsSource="{Binding Results}" SelectedItem="{Binding SelectedResult}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel>
                                <TextBlock Text="{Binding FileName}" FontWeight="Bold"/>
                                <TextBlock Text="{Binding Snippet}" TextWrapping="Wrap"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                <StackPanel Grid.Column="1" Margin="8" DataContext="{Binding SelectedResult}">
                    <TextBlock Text="{Binding FileName}" FontWeight="Bold"/>
                    <TextBlock Text="{Binding Path}" TextWrapping="Wrap"/>
                    <TextBlock Text="{Binding Ext}"/>
                    <TextBlock Text="{Binding SizeBytes}"/>
                    <TextBlock Text="{Binding CreatedUtc}"/>
                    <TextBlock Text="{Binding ModifiedUtc}"/>
                    <Button Content="Otevřít" Command="{Binding DataContext.OpenSelectedCommand, RelativeSource={RelativeSource AncestorType=Grid}}" Margin="0,8,0,0"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</ui:FluentWindow>
