<ui:FluentWindow x:Class="DocFinder.UI.Views.SearchOverlay"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:converters="clr-namespace:DocFinder.UI.Converters"
    Title="DocFinder" Width="900" Height="520"
    WindowStartupLocation="CenterScreen"
    WindowStyle="None"
    WindowCornerPreference="Round"
    ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica"
    ResizeMode="CanResize"
    ShowInTaskbar="True">
    <ui:FluentWindow.Resources>
        <converters:FileSizeConverter x:Key="FileSizeConverter" />
        <converters:UtcToLocalConverter x:Key="UtcToLocalConverter" />
    </ui:FluentWindow.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <ui:TitleBar Grid.Row="0" Title="DocFinder" Foreground="{DynamicResource TextFillColorPrimaryBrush}" />

        <Grid Grid.Row="1" Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Search bar -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <ui:Button
                    x:Name="MenuButton"
                    Width="36"
                    Height="36"
                    Appearance="Secondary"
                    CornerRadius="8"
                    Click="MenuButton_Click">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="Navigation16" />
                    </ui:Button.Icon>
                    <ui:Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Nové hledání" Click="Menu_NewSearch_Click">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Search28" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="Nastavení…" Click="Menu_Settings_Click">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Settings28" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="Přeindexovat" Click="Menu_Reindex_Click">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="ArrowClockwise28" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem x:Name="PauseResumeMenuItem" Header="Pozastavit indexaci" Click="Menu_PauseResume_Click">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon x:Name="PauseResumeIcon" Symbol="PauseCircle24" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="Ukončit" Click="Menu_Exit_Click">
                                <MenuItem.Icon>
                                    <ui:SymbolIcon Symbol="Dismiss28" />
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </ui:Button.ContextMenu>
                </ui:Button>

                <ui:Button
                    Grid.Row="1"
                    Width="36"
                    Height="36"
                    Appearance="Secondary"
                    CornerRadius="8"
                    ToolTip="Filtry">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="Filter24" />
                    </ui:Button.Icon>
                    <ui:Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Vše" Command="{Binding FilterByExtensionCommand}" CommandParameter="all" />
                            <MenuItem Header="PDF" Command="{Binding FilterByExtensionCommand}" CommandParameter="pdf" />
                            <MenuItem Header="DOCX" Command="{Binding FilterByExtensionCommand}" CommandParameter="docx" />
                        </ContextMenu>
                    </ui:Button.ContextMenu>
                </ui:Button>

                <ui:TextBox
                    x:Name="QueryTextBox"
                    Grid.Column="1"
                    Grid.RowSpan="2"
                    Text="{Binding Query, UpdateSourceTrigger=PropertyChanged}"
                    Height="40"
                    Padding="10"
                    Margin="8,0,8,0"
                    PlaceholderEnabled="True"
                    PlaceholderText="Hledat…" />

                <ui:Button
                    Grid.Column="2"
                    Grid.RowSpan="2"
                    Width="36"
                    Height="36"
                    Appearance="Secondary"
                    Command="{Binding SearchCommand}">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="Search28" />
                    </ui:Button.Icon>
                </ui:Button>
            </Grid>

            <!-- Results and detail -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <ui:DataGrid Grid.Column="0"
                              ItemsSource="{Binding Results}"
                              SelectedItem="{Binding SelectedDocument}"
                              AutoGenerateColumns="False"
                              CanUserSortColumns="True"
                              IsReadOnly="True">
                    <ui:DataGrid.Columns>
                        <DataGridTextColumn Header="Název" Binding="{Binding FileName}" />
                        <DataGridTextColumn Header="Typ" Binding="{Binding Ext}" />
                        <DataGridTextColumn Header="Velikost" Binding="{Binding SizeBytes, Converter={StaticResource FileSizeConverter}}" />
                        <DataGridTextColumn Header="Změněno" Binding="{Binding ModifiedUtc, Converter={StaticResource UtcToLocalConverter}}" />
                    </ui:DataGrid.Columns>
                </ui:DataGrid>

                <Grid Grid.Column="1" Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Border Grid.Row="0" BorderThickness="1" BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}">
                        <ContentControl x:Name="PreviewHost" />
                    </Border>
                    <Button Grid.Row="1" Content="Otevřít" Command="{Binding OpenDocumentCommand}" Margin="0,8,0,0" />
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</ui:FluentWindow>
